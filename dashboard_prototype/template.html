<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√çndice de Seguridad Comercial ‚Äî Real Instituto Elcano</title>
    <meta name="description"
        content="Visualizaci√≥n interactiva de dependencias econ√≥micas en cadenas de suministro globales">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        :root {
            --elcano-red: #bb2521;
            --elcano-red-light: #d63834;
            --elcano-red-glow: rgba(187, 37, 33, 0.3);
            --elcano-blue: #003366;
            --elcano-blue-mid: #0066CC;
            --bg-dark: #0a0e17;
            --bg-card: #111827;
            --bg-card-hover: #1a2332;
            --text-primary: #f0f2f5;
            --text-secondary: #8892a4;
            --text-muted: #5a6478;
            --border-subtle: rgba(255, 255, 255, 0.06);
            --border-hover: rgba(187, 37, 33, 0.4);
            --gradient-red: linear-gradient(135deg, #bb2521, #d63834);
            --gradient-blue: linear-gradient(135deg, #003366, #0066CC);
            --shadow-glow: 0 0 30px rgba(187, 37, 33, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* NAV */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            padding: 0 2rem;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(10, 14, 23, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-subtle);
            transition: all 0.3s ease;
        }

        nav.scrolled {
            background: rgba(10, 14, 23, 0.95);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .nav-logo img {
            height: 42px;
        }

        .nav-logo span {
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            letter-spacing: 0.3px;
            transition: color 0.2s;
            position: relative;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--text-primary);
        }

        .nav-links a.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--elcano-red);
            border-radius: 1px;
        }

        /* HERO */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 6rem 2rem 2rem;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(ellipse at 30% 50%, rgba(187, 37, 33, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 50%, rgba(0, 51, 102, 0.06) 0%, transparent 50%);
            animation: heroGlow 8s ease-in-out infinite alternate;
        }

        @keyframes heroGlow {
            0% {
                transform: translate(0, 0) scale(1);
            }

            100% {
                transform: translate(-5%, 5%) scale(1.1);
            }
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 900px;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 16px;
            border-radius: 50px;
            border: 1px solid var(--border-subtle);
            background: rgba(255, 255, 255, 0.03);
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 2rem;
        }

        .hero-badge .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--elcano-red);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(1.5);
            }
        }

        .hero h1 {
            font-size: 4rem;
            font-weight: 800;
            line-height: 1.08;
            letter-spacing: -2px;
            margin-bottom: 1.2rem;
            background: linear-gradient(135deg, #ffffff 0%, #c0c8d4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero h1 em {
            font-style: normal;
            background: var(--gradient-red);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.15rem;
            color: var(--text-secondary);
            line-height: 1.7;
            max-width: 600px;
            margin: 0 auto 2rem;
            font-weight: 300;
        }

        /* GLOBE */
        .globe-wrapper {
            width: 500px;
            height: 500px;
            margin: -1rem auto 0;
            position: relative;
            z-index: 1;
        }

        /* SEARCH */
        .search-container {
            position: relative;
            max-width: 500px;
            margin: 0 auto 1rem;
        }

        .search-bar {
            width: 100%;
            padding: 16px 24px 16px 50px;
            border-radius: 16px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-bar::placeholder {
            color: var(--text-muted);
        }

        .search-bar:focus {
            border-color: var(--elcano-red);
            box-shadow: var(--shadow-glow);
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        .search-results {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 100;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .search-results.active {
            display: block;
        }

        .search-result-item {
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.15s;
            font-size: 0.9rem;
        }

        .search-result-item:hover {
            background: var(--bg-card-hover);
        }

        .search-result-item .flag {
            font-size: 1.3rem;
        }

        .search-result-item .rank {
            margin-left: auto;
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* SCROLL INDICATOR */
        .scroll-indicator {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: var(--text-muted);
            font-size: 0.7rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateX(-50%) translateY(0);
            }

            50% {
                transform: translateX(-50%) translateY(8px);
            }
        }

        .scroll-indicator .arrow {
            width: 20px;
            height: 20px;
            border-right: 2px solid var(--text-muted);
            border-bottom: 2px solid var(--text-muted);
            transform: rotate(45deg);
        }

        /* SECTIONS */
        section {
            padding: 6rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .section-header {
            margin-bottom: 3rem;
        }

        .section-label {
            font-size: 0.7rem;
            font-weight: 600;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--elcano-red);
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: -1px;
            line-height: 1.2;
            margin-bottom: 0.75rem;
        }

        .section-subtitle {
            font-size: 1.05rem;
            color: var(--text-secondary);
            line-height: 1.6;
            max-width: 600px;
            font-weight: 300;
        }

        /* KPI CARDS */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 4rem;
        }

        .kpi-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--border-subtle);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-red);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .kpi-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-2px);
        }

        .kpi-card:hover::before {
            opacity: 1;
        }

        .kpi-value {
            font-size: 2.8rem;
            font-weight: 800;
            letter-spacing: -1px;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .kpi-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }

        .kpi-desc {
            font-size: 0.75rem;
            color: var(--text-muted);
            line-height: 1.4;
            margin-top: 0.5rem;
            font-weight: 300;
            opacity: 0.8;
        }

        /* TOOLTIPS */
        .info-tip {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            cursor: help;
        }

        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.08);
            font-size: 0.6rem;
            color: var(--text-muted);
            font-weight: 700;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .info-tip:hover .info-icon {
            background: var(--elcano-red);
            color: white;
        }

        .info-tip .tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 14px;
            background: #1e2838;
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            white-space: normal;
            width: 240px;
            text-align: left;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 10;
            line-height: 1.4;
            font-weight: 400;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            text-transform: none;
            letter-spacing: normal;
        }

        .info-tip:hover .tooltip {
            opacity: 1;
            pointer-events: auto;
        }

        /* MAP */
        .map-container {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border-subtle);
            padding: 1.5rem;
            margin-bottom: 4rem;
            overflow: hidden;
        }

        /* HUBS */
        .hubs-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }

        .hub-list {
            list-style: none;
        }

        .hub-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-subtle);
            transition: all 0.2s;
            cursor: pointer;
        }

        .hub-item:hover {
            padding-left: 0.5rem;
            background: linear-gradient(90deg, rgba(187, 37, 33, 0.05), transparent);
        }

        .hub-rank {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .hub-rank.top3 {
            background: var(--gradient-red);
            color: white;
        }

        .hub-rank.rest {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
        }

        .hub-country {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .hub-flag {
            font-size: 1.3rem;
        }

        .hub-bar-container {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
            overflow: hidden;
        }

        .hub-bar {
            height: 100%;
            border-radius: 3px;
            background: var(--gradient-red);
            transition: width 1s ease;
        }

        .hub-score {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-weight: 600;
            min-width: 45px;
            text-align: right;
        }

        /* PROFILE */
        .profile-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .profile-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-subtle);
        }

        .profile-flag {
            font-size: 4rem;
        }

        .profile-name {
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -1px;
        }

        .profile-rank-badge {
            margin-left: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
        }

        .profile-rank-badge .rank-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--elcano-red-light);
        }

        .profile-rank-badge .rank-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .profile-kpis {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .profile-kpi {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-subtle);
            text-align: center;
        }

        .profile-kpi .value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
        }

        .profile-kpi .label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-subtle);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.85rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s;
            margin-bottom: 2rem;
        }

        .back-btn:hover {
            border-color: var(--elcano-red);
            color: var(--text-primary);
        }

        /* CRITICAL TABLE */
        .critical-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 4px;
        }

        .critical-table th {
            text-align: left;
            padding: 12px 16px;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .critical-table td {
            padding: 14px 16px;
            font-size: 0.9rem;
            background: var(--bg-card);
            transition: background 0.2s;
        }

        .critical-table tr:hover td {
            background: var(--bg-card-hover);
        }

        .critical-table tr td:first-child {
            border-radius: 10px 0 0 10px;
        }

        .critical-table tr td:last-child {
            border-radius: 0 10px 10px 0;
        }

        .dep-bar {
            display: inline-block;
            height: 4px;
            border-radius: 2px;
            background: var(--elcano-red);
            vertical-align: middle;
            margin-right: 8px;
        }

        .criticidad-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .criticidad-alta {
            background: rgba(187, 37, 33, 0.15);
            color: var(--elcano-red-light);
        }

        .criticidad-media {
            background: rgba(255, 193, 7, 0.15);
            color: #FFC107;
        }

        /* FOOTER */
        footer {
            text-align: center;
            padding: 3rem 2rem;
            border-top: 1px solid var(--border-subtle);
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        footer img {
            height: 40px;
            margin-bottom: 1rem;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }

            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .hubs-grid {
                grid-template-columns: 1fr;
            }

            .profile-kpis {
                grid-template-columns: 1fr;
            }

            .nav-links {
                display: none;
            }

            .globe-wrapper {
                width: 320px;
                height: 320px;
            }
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--text-muted);
            border-radius: 3px;
        }
    </style>
</head>

<body>

    <nav id="navbar">
        <div class="nav-logo">
            <img src="__LOGO_BASE64__" alt="Real Instituto Elcano">
            <span>Seguridad Comercial</span>
        </div>
        <ul class="nav-links">
            <li><a href="#hero" class="active">Inicio</a></li>
            <li><a href="#overview">Panorama</a></li>
            <li><a href="#map-section">Mapa</a></li>
            <li><a href="#hubs-section">Hubs Globales</a></li>
            <li><a href="#critical-section">Relaciones Cr√≠ticas</a></li>
        </ul>
    </nav>

    <section class="hero" id="hero">
        <div class="hero-content">
            <div class="hero-badge">
                <span class="dot"></span>
                <span>Real Instituto Elcano ¬∑ Datos 2022</span>
            </div>
            <h1>¬øDe qui√©n depende<br><em>tu econom√≠a</em>?</h1>
            <p>Explora las dependencias comerciales en cadenas de suministro globales.
                236 econom√≠as, 170 industrias, miles de relaciones analizadas.</p>
            <div class="search-container">
                <span class="search-icon">üîç</span>
                <input type="text" class="search-bar" id="countrySearch"
                    placeholder="Busca un pa√≠s... Espa√±a, China, USA..." autocomplete="off">
                <div class="search-results" id="searchResults"></div>
            </div>
        </div>
        <div class="globe-wrapper">
            <div id="heroGlobe" style="width:100%;height:100%;"></div>
        </div>
        <div class="scroll-indicator">
            <span>Explorar</span>
            <div class="arrow"></div>
        </div>
    </section>

    <section id="overview">
        <div class="section-header">
            <div class="section-label">Panorama Global</div>
            <h2 class="section-title">√çndice de Seguridad Comercial</h2>
            <p class="section-subtitle">Una radiograf√≠a de las dependencias comerciales que definen la estabilidad
                econ√≥mica mundial.</p>
        </div>
        <div class="kpi-grid" id="kpiGrid"></div>
    </section>

    <section id="map-section">
        <div class="section-header">
            <div class="section-label">Mapa de Vulnerabilidad</div>
            <h2 class="section-title">¬øQui√©n es m√°s vulnerable?</h2>
            <p class="section-subtitle">Nivel de vulnerabilidad comercial de cada econom√≠a. Mayor intensidad de rojo
                indica mayor concentraci√≥n de dependencias cr√≠ticas.</p>
        </div>
        <div class="map-container">
            <div id="worldMap" style="height: 520px;"></div>
        </div>
    </section>

    <section id="hubs-section">
        <div class="section-header">
            <div class="section-label">Intermediaci√≥n Global</div>
            <h2 class="section-title">Los nodos del comercio mundial</h2>
            <p class="section-subtitle">Los 30 pa√≠ses que m√°s intermedian en las cadenas de suministro globales. El
                <strong>score</strong> (0-100) combina cu√°ntas rutas pasan por cada pa√≠s y cu√°n insustituible es como
                intermediario. Haz clic en un pa√≠s para ver su perfil detallado.
            </p>
        </div>
        <div class="hubs-grid">
            <ul class="hub-list" id="hubsLeft"></ul>
            <ul class="hub-list" id="hubsRight"></ul>
        </div>
    </section>

    <section id="critical-section">
        <div class="section-header">
            <div class="section-label">Dependencias Cr√≠ticas</div>
            <h2 class="section-title">Relaciones con mayor riesgo</h2>
            <p class="section-subtitle">Las 50 relaciones bilaterales m√°s cr√≠ticas: alta dependencia y pocas
                alternativas comerciales.</p>
        </div>
        <div style="overflow-x: auto;">
            <table class="critical-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Exportador</th>
                        <th>Importador</th>
                        <th>Industria</th>
                        <th title="Porcentaje de las importaciones totales del importador en esta industria que dependen de este exportador. 95% = casi total."
                            style="cursor:help">Dependencia <span class="info-icon">?</span></th>
                        <th title="N√∫mero de proveedores alternativos disponibles. 0 = sin alternativas viables."
                            style="cursor:help">Alternativas <span class="info-icon">?</span></th>
                        <th title="√çndice de criticidad (0-100%). Combina dependencia y falta de alternativas. 100% = m√°ximo riesgo de disrupci√≥n."
                            style="cursor:help">Criticidad <span class="info-icon">?</span></th>
                    </tr>
                </thead>
                <tbody id="criticalBody"></tbody>
            </table>
        </div>
    </section>

    <section id="profile-section" class="profile-section">
        <button class="back-btn" onclick="closeProfile()">‚Üê Volver al panorama</button>
        <div id="profileContent"></div>
    </section>

    <footer>
        <img src="__LOGO_BASE64__" alt="Real Instituto Elcano"><br>
        <p>√çndice de Seguridad Comercial ¬∑ Real Instituto Elcano ¬∑ 2026</p>
        <p style="margin-top: 0.5rem;">Datos: International Trade and Production Database (ITP) ¬∑ A√±o 2022</p>
    </footer>

    <script>
        // === EMBEDDED DATA (no fetch needed) ===
        const DATA = __DATA_JSON__;

        // === COUNTRY NAMES ===
        const COUNTRY_NAMES = { "ABW": "Aruba", "AFG": "Afganist√°n", "AGO": "Angola", "AIA": "Anguila", "ALB": "Albania", "AND": "Andorra", "ARE": "Emiratos √Årabes Unidos", "ARG": "Argentina", "ARM": "Armenia", "ASM": "Samoa Americana", "ATG": "Antigua y Barbuda", "AUS": "Australia", "AUT": "Austria", "AZE": "Azerbaiy√°n", "BDI": "Burundi", "BEL": "B√©lgica", "BEN": "Ben√≠n", "BFA": "Burkina Faso", "BGD": "Banglad√©s", "BGR": "Bulgaria", "BHR": "Bar√©in", "BHS": "Bahamas", "BIH": "Bosnia y Herzegovina", "BLR": "Bielorrusia", "BLZ": "Belice", "BMU": "Bermudas", "BOL": "Bolivia", "BRA": "Brasil", "BRB": "Barbados", "BRN": "Brun√©i", "BTN": "But√°n", "BWA": "Botsuana", "CAF": "Rep. Centroafricana", "CAN": "Canad√°", "CHE": "Suiza", "CHL": "Chile", "CHN": "China", "CIV": "Costa de Marfil", "CMR": "Camer√∫n", "COD": "RD del Congo", "COG": "Congo", "COL": "Colombia", "COM": "Comoras", "CPV": "Cabo Verde", "CRI": "Costa Rica", "CUB": "Cuba", "CYM": "Islas Caim√°n", "CYP": "Chipre", "CZE": "Chequia", "DEU": "Alemania", "DJI": "Yibuti", "DMA": "Dominica", "DNK": "Dinamarca", "DOM": "Rep. Dominicana", "DZA": "Argelia", "ECU": "Ecuador", "EGY": "Egipto", "ERI": "Eritrea", "ESP": "Espa√±a", "EST": "Estonia", "ETH": "Etiop√≠a", "FIN": "Finlandia", "FJI": "Fiyi", "FRA": "Francia", "FSM": "Micronesia", "GAB": "Gab√≥n", "GBR": "Reino Unido", "GEO": "Georgia", "GHA": "Ghana", "GIN": "Guinea", "GMB": "Gambia", "GNB": "Guinea-Bis√°u", "GNQ": "Guinea Ecuatorial", "GRC": "Grecia", "GRD": "Granada", "GRL": "Groenlandia", "GTM": "Guatemala", "GUM": "Guam", "GUY": "Guyana", "HKG": "Hong Kong", "HND": "Honduras", "HRV": "Croacia", "HTI": "Hait√≠", "HUN": "Hungr√≠a", "IDN": "Indonesia", "IND": "India", "IRL": "Irlanda", "IRN": "Ir√°n", "IRQ": "Irak", "ISL": "Islandia", "ISR": "Israel", "ITA": "Italia", "JAM": "Jamaica", "JOR": "Jordania", "JPN": "Jap√≥n", "KAZ": "Kazajist√°n", "KEN": "Kenia", "KGZ": "Kirguist√°n", "KHM": "Camboya", "KIR": "Kiribati", "KNA": "San Crist√≥bal y Nieves", "KOR": "Corea del Sur", "KWT": "Kuwait", "LAO": "Laos", "LBN": "L√≠bano", "LBR": "Liberia", "LBY": "Libia", "LCA": "Santa Luc√≠a", "LKA": "Sri Lanka", "LSO": "Lesoto", "LTU": "Lituania", "LUX": "Luxemburgo", "LVA": "Letonia", "MAC": "Macao", "MAR": "Marruecos", "MDA": "Moldavia", "MDG": "Madagascar", "MDV": "Maldivas", "MEX": "M√©xico", "MHL": "Islas Marshall", "MKD": "Macedonia del Norte", "MLI": "Mal√≠", "MLT": "Malta", "MMR": "Myanmar", "MNE": "Montenegro", "MNG": "Mongolia", "MOZ": "Mozambique", "MRT": "Mauritania", "MUS": "Mauricio", "MWI": "Malaui", "MYS": "Malasia", "NAM": "Namibia", "NER": "N√≠ger", "NGA": "Nigeria", "NIC": "Nicaragua", "NLD": "Pa√≠ses Bajos", "NOR": "Noruega", "NPL": "Nepal", "NRU": "Nauru", "NZL": "Nueva Zelanda", "OMN": "Om√°n", "PAK": "Pakist√°n", "PAN": "Panam√°", "PER": "Per√∫", "PHL": "Filipinas", "PLW": "Palaos", "PNG": "Pap√∫a Nueva Guinea", "POL": "Polonia", "PRI": "Puerto Rico", "PRK": "Corea del Norte", "PRT": "Portugal", "PRY": "Paraguay", "QAT": "Catar", "ROU": "Ruman√≠a", "RUS": "Rusia", "RWA": "Ruanda", "SAU": "Arabia Saud√≠", "SDN": "Sud√°n", "SEN": "Senegal", "SGP": "Singapur", "SLB": "Islas Salom√≥n", "SLE": "Sierra Leona", "SLV": "El Salvador", "SMR": "San Marino", "SOM": "Somalia", "SRB": "Serbia", "SSD": "Sud√°n del Sur", "STP": "Santo Tom√© y Pr√≠ncipe", "SUR": "Surinam", "SVK": "Eslovaquia", "SVN": "Eslovenia", "SWE": "Suecia", "SWZ": "Esuatini", "SYC": "Seychelles", "SYR": "Siria", "TCA": "Islas Turcas y Caicos", "TCD": "Chad", "TGO": "Togo", "THA": "Tailandia", "TJK": "Tayikist√°n", "TKM": "Turkmenist√°n", "TLS": "Timor Oriental", "TON": "Tonga", "TTO": "Trinidad y Tobago", "TUN": "T√∫nez", "TUR": "Turqu√≠a", "TUV": "Tuvalu", "TWN": "Taiw√°n", "TZA": "Tanzania", "UGA": "Uganda", "UKR": "Ucrania", "URY": "Uruguay", "USA": "Estados Unidos", "UZB": "Uzbekist√°n", "VCT": "San Vicente y Granadinas", "VEN": "Venezuela", "VGB": "Islas V√≠rgenes Brit√°nicas", "VIR": "Islas V√≠rgenes de EE.UU.", "VNM": "Vietnam", "VUT": "Vanuatu", "WSM": "Samoa", "YEM": "Yemen", "ZAF": "Sud√°frica", "ZMB": "Zambia", "ZWE": "Zimbabue" };

        const ISO3_TO_ISO2 = { "ABW": "AW", "AFG": "AF", "AGO": "AO", "ALB": "AL", "AND": "AD", "ARE": "AE", "ARG": "AR", "ARM": "AM", "AUS": "AU", "AUT": "AT", "AZE": "AZ", "BDI": "BI", "BEL": "BE", "BEN": "BJ", "BFA": "BF", "BGD": "BD", "BGR": "BG", "BHR": "BH", "BHS": "BS", "BIH": "BA", "BLR": "BY", "BLZ": "BZ", "BOL": "BO", "BRA": "BR", "BRB": "BB", "BRN": "BN", "BTN": "BT", "BWA": "BW", "CAF": "CF", "CAN": "CA", "CHE": "CH", "CHL": "CL", "CHN": "CN", "CIV": "CI", "CMR": "CM", "COD": "CD", "COG": "CG", "COL": "CO", "CRI": "CR", "CUB": "CU", "CYP": "CY", "CZE": "CZ", "DEU": "DE", "DJI": "DJ", "DNK": "DK", "DOM": "DO", "DZA": "DZ", "ECU": "EC", "EGY": "EG", "ERI": "ER", "ESP": "ES", "EST": "EE", "ETH": "ET", "FIN": "FI", "FJI": "FJ", "FRA": "FR", "GAB": "GA", "GBR": "GB", "GEO": "GE", "GHA": "GH", "GIN": "GN", "GMB": "GM", "GNB": "GW", "GNQ": "GQ", "GRC": "GR", "GRL": "GL", "GTM": "GT", "GUY": "GY", "HKG": "HK", "HND": "HN", "HRV": "HR", "HTI": "HT", "HUN": "HU", "IDN": "ID", "IND": "IN", "IRL": "IE", "IRN": "IR", "IRQ": "IQ", "ISL": "IS", "ISR": "IL", "ITA": "IT", "JAM": "JM", "JOR": "JO", "JPN": "JP", "KAZ": "KZ", "KEN": "KE", "KGZ": "KG", "KHM": "KH", "KOR": "KR", "KWT": "KW", "LAO": "LA", "LBN": "LB", "LBR": "LR", "LBY": "LY", "LKA": "LK", "LSO": "LS", "LTU": "LT", "LUX": "LU", "LVA": "LV", "MAC": "MO", "MAR": "MA", "MDA": "MD", "MDG": "MG", "MDV": "MV", "MEX": "MX", "MKD": "MK", "MLI": "ML", "MLT": "MT", "MMR": "MM", "MNE": "ME", "MNG": "MN", "MOZ": "MZ", "MRT": "MR", "MUS": "MU", "MWI": "MW", "MYS": "MY", "NAM": "NA", "NER": "NE", "NGA": "NG", "NIC": "NI", "NLD": "NL", "NOR": "NO", "NPL": "NP", "NZL": "NZ", "OMN": "OM", "PAK": "PK", "PAN": "PA", "PER": "PE", "PHL": "PH", "PNG": "PG", "POL": "PL", "PRT": "PT", "PRY": "PY", "QAT": "QA", "ROU": "RO", "RUS": "RU", "RWA": "RW", "SAU": "SA", "SDN": "SD", "SEN": "SN", "SGP": "SG", "SLE": "SL", "SLV": "SV", "SMR": "SM", "SOM": "SO", "SRB": "RS", "SSD": "SS", "SUR": "SR", "SVK": "SK", "SVN": "SI", "SWE": "SE", "SWZ": "SZ", "SYR": "SY", "TCD": "TD", "TGO": "TG", "THA": "TH", "TJK": "TJ", "TKM": "TM", "TLS": "TL", "TON": "TO", "TTO": "TT", "TUN": "TN", "TUR": "TR", "TWN": "TW", "TZA": "TZ", "UGA": "UG", "UKR": "UA", "URY": "UY", "USA": "US", "UZB": "UZ", "VEN": "VE", "VNM": "VN", "YEM": "YE", "ZAF": "ZA", "ZMB": "ZM", "ZWE": "ZW" };

        function getFlag(iso3) {
            const iso2 = ISO3_TO_ISO2[iso3];
            if (!iso2) return 'üè≥Ô∏è';
            return String.fromCodePoint(...[...iso2].map(c => 0x1F1E6 + c.charCodeAt(0) - 65));
        }
        function getName(iso3) { return COUNTRY_NAMES[iso3] || iso3; }

        // === INIT ===
        document.addEventListener('DOMContentLoaded', function () {
            initKPIs();
            initGlobe();
            initMap();
            initHubs();
            initCritical();
            initSearch();
        });

        // === KPIs ===
        function initKPIs() {
            const p = DATA.profiles;
            const avgV = (p.reduce((s, x) => s + x.vulnerability, 0) / p.length).toFixed(3);
            const kpis = [
                { value: '236', label: 'Econom√≠as analizadas', desc: 'Cada pa√≠s evaluado seg√∫n su exposici√≥n a disrupciones en cadenas de suministro.' },
                { value: '170', label: 'Industrias cubiertas', desc: 'Sectores productivos analizados, desde materias primas hasta manufactura avanzada.' },
                { value: avgV, label: 'Vulnerabilidad media', desc: 'Promedio global del √≠ndice (0-1). Cuanto m√°s alto, mayor riesgo de disrupci√≥n comercial.' },
                { value: getFlag(DATA.hubs[0].country), label: 'Mayor intermediario', isFlag: true, sub: getName(DATA.hubs[0].country), desc: 'El pa√≠s que m√°s rutas comerciales intermedia a nivel global.' }
            ];
            document.getElementById('kpiGrid').innerHTML = kpis.map(k => `
        <div class="kpi-card">
            <div class="kpi-value" ${k.isFlag ? 'style="font-size:3.5rem;-webkit-text-fill-color:unset"' : ''}>${k.value}</div>
            <div class="kpi-label">${k.label}</div>
            ${k.sub ? '<div style="color:var(--text-secondary);font-size:0.9rem;margin-top:0.3rem">' + k.sub + '</div>' : ''}
            <div class="kpi-desc">${k.desc}</div>
        </div>`).join('');
        }

        // === ROTATING GLOBE ===
        function initGlobe() {
            const p = DATA.profiles;
            const gData = [{
                type: 'choropleth', locationmode: 'ISO-3',
                locations: p.map(x => x.country),
                z: p.map(x => x.vulnerability),
                text: p.map(x => getName(x.country) + '<br>Vulnerabilidad: ' + x.vulnerability.toFixed(3) + '<br><i>0 = bajo riesgo ¬∑ 1 = alto riesgo</i>'),
                hoverinfo: 'text',
                colorscale: [[0, '#1a1f2e'], [0.3, '#3d1515'], [0.6, '#8b2525'], [1, '#ff4040']],
                showscale: false,
                marker: { line: { color: '#0a0e17', width: 0.3 } }
            }];
            let rot = { lon: -20, lat: 15 };
            const layout = {
                geo: {
                    projection: { type: 'orthographic', rotation: rot },
                    bgcolor: 'rgba(0,0,0,0)', showframe: false,
                    showcoastlines: true, coastlinecolor: '#2a3040',
                    showland: true, landcolor: '#1a2332',
                    showocean: true, oceancolor: '#0d1117',
                    showlakes: false, showcountries: true, countrycolor: '#1e2838',
                    lonaxis: { showgrid: false }, lataxis: { showgrid: false }
                },
                paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)',
                margin: { t: 0, b: 0, l: 0, r: 0 }, font: { family: 'Inter' }
            };
            Plotly.newPlot('heroGlobe', gData, layout, { responsive: true, displayModeBar: false, scrollZoom: false });

            let anim = true;
            function spin() { if (!anim) return; rot.lon += 0.3; Plotly.relayout('heroGlobe', { 'geo.projection.rotation.lon': rot.lon }); requestAnimationFrame(spin); }
            spin();
            const el = document.getElementById('heroGlobe');
            el.addEventListener('mouseenter', () => { anim = false; });
            el.addEventListener('mouseleave', () => { anim = true; spin(); });
            el.on('plotly_click', d => { if (d.points[0]) showProfile(d.points[0].location); });
        }

        // === WORLD MAP ===
        function initMap() {
            const p = DATA.profiles;
            Plotly.newPlot('worldMap', [{
                type: 'choropleth', locationmode: 'ISO-3',
                locations: p.map(x => x.country), z: p.map(x => x.vulnerability),
                text: p.map(x => getName(x.country) + '<br>Vulnerabilidad: ' + x.vulnerability.toFixed(3) + ' <i>(0 = bajo ¬∑ 1 = alto)</i>' + '<br>Ranking: #' + x.global_rank + ' de 236'),
                hoverinfo: 'text',
                colorscale: [[0, '#1a1f2e'], [0.2, '#2d1a1a'], [0.4, '#5c2020'], [0.6, '#8b2525'], [0.8, '#bb2521'], [1, '#ff4040']],
                showscale: true,
                colorbar: { title: { text: 'Vulnerabilidad', font: { color: '#8892a4', size: 11 } }, tickfont: { color: '#8892a4', size: 10 }, thickness: 12, len: 0.5, bgcolor: 'rgba(0,0,0,0)', borderwidth: 0, x: 1.02 },
                marker: { line: { color: '#1a2332', width: 0.5 } }
            }], {
                geo: { bgcolor: 'rgba(0,0,0,0)', showframe: false, showcoastlines: true, coastlinecolor: '#2a3040', showland: true, landcolor: '#1a2332', showocean: true, oceancolor: '#0d1117', showlakes: false, showcountries: true, countrycolor: '#2a3040', projection: { type: 'natural earth' } },
                paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', margin: { t: 10, b: 10, l: 10, r: 40 }, font: { family: 'Inter' }
            }, { responsive: true, displayModeBar: false, scrollZoom: false });
            document.getElementById('worldMap').on('plotly_click', d => { if (d.points[0]) showProfile(d.points[0].location); });
        }

        // === HUBS ===
        function initHubs() {
            const h = DATA.hubs, max = h[0].global_score;
            const half = Math.ceil(h.length / 2);
            function render(list, el) {
                el.innerHTML = list.map(x => `
            <li class="hub-item" onclick="showProfile('${x.country}')">
                <div class="hub-rank ${x.global_rank <= 3 ? 'top3' : 'rest'}">${x.global_rank}</div>
                <span class="hub-flag">${getFlag(x.country)}</span>
                <div style="min-width:120px"><div class="hub-country">${getName(x.country)}</div>
                <div style="font-size:0.7rem;color:var(--text-muted)">${x.frequency_total.toLocaleString()} rutas</div></div>
                <div class="hub-bar-container"><div class="hub-bar" style="width:${(x.global_score / max * 100).toFixed(1)}%"></div></div>
                <span class="hub-score" title="Score de intermediaci√≥n global (0-100). Mide cu√°ntas cadenas de suministro pasan por este pa√≠s.">${(x.global_score * 100).toFixed(1)}</span>
            </li>`).join('');
            }
            render(h.slice(0, half), document.getElementById('hubsLeft'));
            render(h.slice(half), document.getElementById('hubsRight'));
        }

        // === CRITICAL TABLE ===
        function initCritical() {
            document.getElementById('criticalBody').innerHTML = DATA.critical.map((r, i) => {
                const depPct = (r.dependencia_total * 100).toFixed(1);
                const critPct = (r.criticidad * 100).toFixed(0);
                const altLabel = r.caminos_alternativos === 0 ? '‚ö†Ô∏è Ninguna' : r.caminos_alternativos;
                const critLabel = critPct >= 100 ? 'M√°xima' : critPct >= 80 ? 'Muy alta' : 'Alta';
                return `
        <tr>
            <td style="color:var(--text-muted);font-weight:600">${i + 1}</td>
            <td>${getFlag(r.exportador)} ${getName(r.exportador)}</td>
            <td>${getFlag(r.importador)} ${getName(r.importador)}</td>
            <td style="font-size:0.8rem;color:var(--text-secondary);max-width:200px">${r.industry}</td>
            <td><span class="dep-bar" style="width:${r.dependencia_total * 80}px"></span>${depPct}%</td>
            <td style="text-align:center;font-size:0.8rem;color:${r.caminos_alternativos === 0 ? 'var(--elcano-red-light)' : 'var(--text-secondary)'}">${altLabel}</td>
            <td><span class="criticidad-badge ${r.criticidad >= 0.8 ? 'criticidad-alta' : 'criticidad-media'}">${critLabel} ¬∑ ${critPct}%</span></td>
        </tr>`}).join('');
        }

        // === SEARCH ===
        function initSearch() {
            const input = document.getElementById('countrySearch'), res = document.getElementById('searchResults');
            input.addEventListener('input', function () {
                const q = this.value.toLowerCase().trim();
                if (q.length < 1) { res.classList.remove('active'); return; }
                const m = DATA.profiles.filter(p => getName(p.country).toLowerCase().includes(q) || p.country.toLowerCase().includes(q)).slice(0, 8);
                if (!m.length) { res.classList.remove('active'); return; }
                res.innerHTML = m.map(p => `<div class="search-result-item" onclick="showProfile('${p.country}')"><span class="flag">${getFlag(p.country)}</span><span>${getName(p.country)}</span><span class="rank">#${p.global_rank}</span></div>`).join('');
                res.classList.add('active');
            });
            input.addEventListener('blur', () => setTimeout(() => res.classList.remove('active'), 200));
        }

        // === PROFILE ===
        function showProfile(iso3) {
            const profile = DATA.profiles.find(p => p.country === iso3);
            if (!profile) return;
            const deps = DATA.dependencies.filter(d => d.dependent_country === iso3).sort((a, b) => b.dependency_value - a.dependency_value);
            const bilat = DATA.bilateral.filter(b => b.importer === iso3).sort((a, b) => b.criticidad - a.criticidad);
            const hub = DATA.hubs.find(h => h.country === iso3);

            const c = document.getElementById('profileContent');
            c.innerHTML = `
        <div class="profile-header">
            <span class="profile-flag">${getFlag(iso3)}</span>
            <div><div class="profile-name">${getName(iso3)}</div><div style="color:var(--text-secondary);font-size:0.9rem">${iso3} ¬∑ Datos 2022</div></div>
            <div class="profile-rank-badge"><span class="rank-number">#${profile.global_rank}</span><span class="rank-label">Ranking global</span></div>
        </div>
        <div class="profile-kpis">
            <div class="profile-kpi">
                <div class="value" style="color:var(--elcano-red-light)">${profile.vulnerability.toFixed(3)}</div>
                <div class="label">Vulnerabilidad</div>
                <div class="kpi-desc">√çndice 0-1. Cuanto m√°s alto, mayor exposici√≥n a disrupciones en cadenas de suministro.</div>
            </div>
            <div class="profile-kpi">
                <div class="value">${(profile.indirect_share * 100).toFixed(1)}%</div>
                <div class="label">Dependencia indirecta</div>
                <div class="kpi-desc">Porcentaje de importaciones que pasan por intermediarios, sin acceso directo al productor original.</div>
            </div>
            <div class="profile-kpi">
                <div class="value">${profile.num_suppliers_effective.toFixed(1)}</div>
                <div class="label">Proveedores efectivos</div>
                <div class="kpi-desc">N√∫mero medio de proveedores reales por industria. Menos proveedores = mayor concentraci√≥n y riesgo.</div>
            </div>
        </div>
        ${hub ? `<div style="background:var(--bg-card);border-radius:16px;padding:1.5rem;border:1px solid var(--border-subtle);margin-bottom:2rem">
            <div class="section-label" style="margin-bottom:0.5rem">Intermediaci√≥n Global</div>
            <div style="font-size:0.78rem;color:var(--text-muted);margin-bottom:1rem;line-height:1.5">Mide la importancia del pa√≠s como nodo en cadenas de suministro globales. Un alto score significa que muchas rutas comerciales pasan por este pa√≠s.</div>
            <div style="display:flex;gap:2rem;align-items:center;flex-wrap:wrap">
                <div><span style="font-size:2rem;font-weight:700">#${hub.global_rank}</span> <span style="color:var(--text-muted)">de 236 econom√≠as</span></div>
                <div><span style="font-size:1.3rem;font-weight:600">${hub.frequency_total.toLocaleString()}</span> <span style="color:var(--text-muted)">rutas intermediadas</span></div>
                <div><span style="font-size:1.3rem;font-weight:600">${(hub.global_score * 100).toFixed(1)}</span> <span style="color:var(--text-muted)">score (0-100)</span></div>
            </div></div>` : ''}
        <div class="section-label" style="margin-bottom:1rem;margin-top:2rem">Principales dependencias por industria</div>
        <div id="profileTreemap" style="height:400px;background:var(--bg-card);border-radius:16px;border:1px solid var(--border-subtle);padding:1rem;margin-bottom:2rem"></div>
        ${bilat.length ? `<div class="section-label" style="margin-bottom:1rem;margin-top:2rem">Proveedores m√°s cr√≠ticos</div>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:1rem">
            ${bilat.slice(0, 12).map(b => {
                const critPct = (b.criticidad * 100).toFixed(0);
                const critColor = critPct >= 80 ? 'var(--elcano-red-light)' : critPct >= 50 ? '#FFC107' : 'var(--text-secondary)';
                const critLabel = critPct >= 80 ? 'Muy alta' : critPct >= 50 ? 'Alta' : 'Moderada';
                return `<div style="background:var(--bg-card);border-radius:12px;padding:1rem;border:1px solid var(--border-subtle);display:flex;align-items:center;gap:10px">
                <span style="font-size:1.5rem">${getFlag(b.exporter)}</span><div><div style="font-weight:600;font-size:0.9rem">${getName(b.exporter)}</div><div style="font-size:0.72rem;color:${critColor}">${critLabel} (${critPct}%)</div><div style="font-size:0.65rem;color:var(--text-muted)">Sin este proveedor, ¬øcu√°ntas industrias se ver√≠an afectadas?</div></div>
            </div>`}).join('')}
        </div>` : ''}`;

            if (deps.length) {
                Plotly.newPlot('profileTreemap', [{
                    type: 'treemap',
                    labels: deps.map(d => d.industry.length > 30 ? d.industry.substring(0, 30) + '...' : d.industry),
                    parents: deps.map(() => ''), values: deps.map(d => d.dependency_value),
                    text: deps.map(d => d.industry + '<br>Dep: ' + (d.dependency_value * 100).toFixed(2) + '%'), hoverinfo: 'text',
                    textinfo: 'label+percent parent',
                    marker: { colors: deps.map(d => d.dependency_value), colorscale: [[0, '#2d1a1a'], [0.5, '#8b2525'], [1, '#ff4040']], line: { width: 1, color: '#1a2332' } },
                    textfont: { family: 'Inter', size: 11, color: '#f0f2f5' }
                }], { paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', margin: { t: 10, b: 10, l: 10, r: 10 }, font: { family: 'Inter' } },
                    { responsive: true, displayModeBar: false });
            }

            document.getElementById('profile-section').classList.add('active');
            document.getElementById('profile-section').scrollIntoView({ behavior: 'smooth' });
            document.getElementById('countrySearch').value = '';
            document.getElementById('searchResults').classList.remove('active');
        }

        function closeProfile() {
            document.getElementById('profile-section').classList.remove('active');
            document.getElementById('overview').scrollIntoView({ behavior: 'smooth' });
        }

        // === NAV ===
        window.addEventListener('scroll', () => {
            document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 50);
            const sects = ['hero', 'overview', 'map-section', 'hubs-section', 'critical-section'];
            let cur = '';
            sects.forEach(id => { const el = document.getElementById(id); if (el && window.scrollY >= el.offsetTop - 200) cur = id; });
            document.querySelectorAll('.nav-links a').forEach(a => { a.classList.toggle('active', a.getAttribute('href') === '#' + cur); });
        });
        document.querySelectorAll('.nav-links a').forEach(a => {
            a.addEventListener('click', function (e) { e.preventDefault(); document.querySelector(this.getAttribute('href'))?.scrollIntoView({ behavior: 'smooth' }); });
        });
    </script>
</body>

</html>